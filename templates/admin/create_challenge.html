{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Create New Challenge</h4>
                </div>
                <div class="card-body">
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }}" role="alert">
                                    {{ message }}
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    {% if challenge_info %}
                    <div class="alert alert-success mb-4">
                        <h5>Challenge Created Successfully!</h5>
                        <div class="mt-3">
                            <h6>Challenge Details:</h6>
                            <ul class="list-unstyled">
                                <li><strong>Challenge ID:</strong> {{ challenge_info.id }}</li>
                                <li><strong>Type:</strong> {{ challenge_info.type }}</li>
                                <li><strong>Difficulty:</strong> {{ challenge_info.difficulty }}</li>
                            </ul>
                            
                            <h6 class="mt-3">Encryption Details:</h6>
                            <ul class="list-unstyled">
                                <li><strong>Key:</strong> <code>{{ challenge_info.key }}</code></li>
                                <li><strong>IV:</strong> <code>{{ challenge_info.iv }}</code></li>
                                <li><strong>Flag:</strong> <code>{{ challenge_info.flag }}</code></li>
                            </ul>
                            
                            <h6 class="mt-3">Encrypted Message:</h6>
                            <pre class="bg-light p-3 rounded"><code>{{ challenge_info.encrypted_message }}</code></pre>
                        </div>
                    </div>
                    {% endif %}

                    <form method="POST" action="{{ url_for('admin.create_challenge') }}" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="challenge_id" class="form-label">Challenge ID</label>
                            <input type="text" class="form-control" id="challenge_id" name="challenge_id" required>
                            <div class="form-text">Unique identifier for the challenge (e.g., aes_easy_1)</div>
                        </div>

                        <div class="mb-3">
                            <label for="challenge_type" class="form-label">Challenge Type</label>
                            <select class="form-select" id="challenge_type" name="challenge_type" required>
                                <option value="">Select a challenge type</option>
                                <option value="aes">AES Encryption</option>
                                <option value="vigenere">Vigenere Cipher</option>
                                <option value="rsa">RSA Encryption</option>
                                <option value="xor">XOR Encryption</option>
                                <option value="des">DES Encryption</option>
                                <option value="rc4">RC4 Stream Cipher</option>
                                <option value="blowfish">Blowfish Encryption</option>
                                <option value="hash">Hash Cracking</option>
                                <option value="web">Web Security</option>
                                <option value="binary">Binary Exploitation</option>
                                <option value="forensics">Digital Forensics</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="difficulty" class="form-label">Difficulty</label>
                            <select class="form-select" id="difficulty" name="difficulty" required>
                                <option value="easy">Easy</option>
                                <option value="medium">Medium</option>
                                <option value="hard">Hard</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
                        </div>

                        <!-- File Upload Field -->
                        <div class="mb-3">
                            <label for="challenge_file" class="form-label">Challenge Files</label>
                            <input type="file" class="form-control" id="challenge_file" name="challenge_file" multiple>
                            <div class="form-text">Upload any files needed for the challenge (e.g., encrypted files, binaries, etc.)</div>
                        </div>

                        <!-- Crypto-specific fields -->
                        <div id="crypto-fields" style="display: none;">
                            <div class="mb-3">
                                <label for="key_length" class="form-label">Key Length (bits)</label>
                                <select class="form-select" id="key_length" name="key_length">
                                    <option value="128">128 bits</option>
                                    <option value="192">192 bits</option>
                                    <option value="256">256 bits</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="encryption_mode" class="form-label">Encryption Mode</label>
                                <select class="form-select" id="encryption_mode" name="encryption_mode">
                                    <option value="CBC">CBC (Cipher Block Chaining)</option>
                                    <option value="ECB">ECB (Electronic Codebook)</option>
                                    <option value="CFB">CFB (Cipher Feedback)</option>
                                    <option value="OFB">OFB (Output Feedback)</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="message" class="form-label">Message to Encrypt</label>
                                <textarea class="form-control" id="message" name="message" rows="2"></textarea>
                                <div class="form-text">Leave empty to use a random message</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="points" class="form-label">Points</label>
                            <input type="number" class="form-control" id="points" name="points" min="0" value="100" required>
                        </div>

                        <div class="mb-3">
                            <label for="flag" class="form-label">Flag</label>
                            <input type="text" class="form-control" id="flag" name="flag" required>
                            <div class="form-text">The flag that users need to submit to solve the challenge.</div>
                        </div>

                        <div class="mb-3">
                            <label for="hints" class="form-label">Hints (one per line)</label>
                            <textarea class="form-control" id="hints" name="hints" rows="3"></textarea>
                            <div class="form-text">Enter hints one per line. These will be revealed progressively.</div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">Create Challenge</button>
                            <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const challengeType = document.getElementById('challenge_type');
    const cryptoFields = document.getElementById('crypto-fields');
    
    challengeType.addEventListener('change', function() {
        const isCrypto = ['aes', 'vigenere', 'rsa', 'xor', 'des', 'rc4', 'blowfish'].includes(this.value);
        cryptoFields.style.display = isCrypto ? 'block' : 'none';
    });
});
</script>
{% endblock %}
 